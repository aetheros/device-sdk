<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AOS Device SDK: AOS Device App SDK Sample Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AOS Device SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">AOS Device App SDK Sample Application</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Quick Start Guide</h1>
<h2>1. Install the SDK.</h2>
<p>Download the SDK installer and run it. It will prompt you for an install location.</p>
<div class="fragment"><div class="line">aos SDK installer version v7.1.2</div>
<div class="line">==========================================</div>
<div class="line">Enter target directory for SDK (default: /opt/tools/aos-sdk-7.1.2):</div>
</div><!-- fragment --><p>Here's a complete example of installing the SDK under /opt/tools:</p>
<div class="fragment"><div class="line">$ ./aos-sdk-toolchain-v7.1.2.sh</div>
<div class="line">AOS SDK installer version v7.1.2</div>
<div class="line">=====================================</div>
<div class="line">Enter target directory for SDK (default: /opt/tools/aos-sdk-7.1.2): &lt;Enter&gt;</div>
<div class="line">You are about to install the SDK to &quot;/opt/tools/aos-sdk-7.1.2&quot;. Proceed [Y/n]? &lt;Enter&gt;</div>
<div class="line">Extracting SDK..........................................................................done</div>
<div class="line">Setting it up...done</div>
<div class="line">SDK has been successfully set up and is ready to be used.</div>
<div class="line">Each time you wish to use the SDK in a new shell session, you need to source the environment setup script e.g.</div>
<div class="line"> $ . /opt/tools/aos-sdk-7.1.2/environment-setup-aarch64-oe-linux</div>
</div><!-- fragment --><h2>2. Clone the sample app from <a href="https://github.com/aetheros/aos-metering-app.git">github</a>.</h2>
<div class="fragment"><div class="line">git clone https://github.com/aetheros/aos-metering-app.git</div>
<div class="line">cd aos-metering-app</div>
</div><!-- fragment --><h2>3. Build the sample app using the SDK toolchain.</h2>
<p>SDK versions 6.9.2 and above provide a <code>aossdkshell</code> script which will create a development shell, in which the shell environment is set up for using the SDK toolchain. It will change the shell prompt to make it clear to the user that the SDK environment is sourced, meaning it is configured for cross compilation, and SDK tools are in the default PATH. You can exit out of the development shell with the <code>exit</code> command. </p><div class="fragment"><div class="line">$ /opt/tools/aos-sdk-7.1.2/aossdkshell</div>
<div class="line">{aossdk} $</div>
</div><!-- fragment --><p>Alternatively, source the environment file as indicated at SDK installation. It will set the environment in the current shell for using the SDK tools and cross compilation. </p><div class="fragment"><div class="line">. /opt/tools/aos-sdk-7.1.2/environment-setup-aarch64-oe-linux</div>
</div><!-- fragment --><p>Run <code>make</code> to build the app.</p>
<p>Once the app is built, several SDK tools can be used for app testing and packaging:</p>
<ul>
<li><code>aosapp</code> - Install, Uninstall, Activate, and Deactivate the app on a connected development device.</li>
<li><code>aospkg</code> - Create an unsigned AOS package.</li>
<li><code>aoscsr</code> - Perform a Certificate Signing Request to create a key/certificate pair for code signing.</li>
<li><code>aossignpkg</code> - Create a signed AOS package using the certificate/key pair generated by <code>aoscsr</code>.</li>
</ul>
<h2>4. Install the app on a device and activate it.</h2>
<p>Connect a device to your host via USB or Wi-Fi. Make sure you have the <code>adb</code> command installed. On Ubuntu, it is in the <b>android-tools-adb</b> package.</p>
<p>Refer to <a class="el" href="md_quickstart.html#adbwifi">ADB over Wi-Fi</a> if connecting to the device over Wi-Fi.</p>
<p>Confirm you can open an <a class="el" href="md_quickstart.html#adbshell">ADB shell</a> on the device.</p>
<p>Use the <b>aosapp</b> command to install and activate the app. Run <code>aosapp install</code> to install the app on the connected device. Use the <code>-s &lt;serialno&gt;</code> option if there are multiple devices connected. If the application installs successfully, it can then be activated with <code>aosapp activate</code>.</p>
<p>Run <code>aosapp -h</code> to see the list of options.</p>
<h1>Common commands</h1>
<h2>Starting and stopping the app</h2>
<p>Use <b>aosapp</b> to control whether the app is activated on the device, meaning it will run automatically.</p>
<ul>
<li><code>aosapp activate</code> - Enable the app so it is always running.</li>
<li><code>aosapp deactivate</code> - Disable the app so it does not run.</li>
</ul>
<p>To simply stop, start, or restart an app, use <b>prctl</b> from a device shell.</p>
<ul>
<li><code>prctl stop &lt;appname&gt;</code> - Stop the app</li>
<li><code>prctl start &lt;appname&gt;</code> - Start the app</li>
<li><code>prctl restart &lt;appname&gt;</code> - Restart the app</li>
<li><code>prctl status &lt;appname&gt;</code> - Check the status of the app</li>
</ul>
<div class="fragment"><div class="line">/ $ prctl stop aos_metering_app</div>
<div class="line">aos_metering_app   stopping     [ok]</div>
<div class="line">/ $</div>
<div class="line">/ $ prctl start aos_metering_app</div>
<div class="line">aos_metering_app   running      [ok] (last killed by signal: 9)</div>
<div class="line">/ $</div>
<div class="line">/ $ prctl restart aos_metering_app</div>
<div class="line">aos_metering_app   want-running [ok] (last killed by signal: 9)</div>
<div class="line">/ $</div>
<div class="line">/ $ prctl status aos_metering_app</div>
<div class="line">aos_metering_app   running      [ok] (last killed by signal: 9)</div>
</div><!-- fragment --><p>When stopping the app, if it does not exit in response to a SIGTERM sent by the supervisor process, it will be terminated after a few seconds with SIGKILL (9). <b>prctl</b> reports this fact in the status as "(last killed by signal: 9)".</p>
<h2>Updating the app</h2>
<p>Until further notice, the app can only be updated by first uninstalling it, and then installing the new version.</p>
<div class="fragment"><div class="line">aosapp uninstall</div>
<div class="line">aosapp install</div>
<div class="line">aosapp activate</div>
</div><!-- fragment --><h2><a class="anchor" id="adbshell"></a>
Accessing a device shell wth ADB</h2>
<p>Use the <b>adb</b> command to access a device, either over USB or Wi-Fi. Running <code>adb shell</code> will drop you into a shell as the <b>apps</b> user. Common linux commands can be run from this shell.</p>
<p>If multiple devices are attached, use the <code>-s</code> option to select a device by its serial number. <code>adb devices</code> will list all the connected devices.</p>
<p>If you specify a command and arguments after <code>adb shell</code>, adb will run that command in a shell.</p>
<p>Example: </p><div class="fragment"><div class="line">$ adb shell cat /etc/issue</div>
<div class="line">aos esr3-kv2 7.2.0 7.2.0-R-20250603:213704-g658fff9</div>
<div class="line">$</div>
</div><!-- fragment --><h3><a class="anchor" id="adbwifi"></a>
ADB over Wi-Fi</h3>
<p>When USB is not available and the development host is connected to a device's Wi-Fi AP, a connection must first be made between the host's adb service the the device's adb service.</p>
<p>Create a connection to the device's adb service: </p><div class="fragment"><div class="line">adb connect 192.168.225.1:5555</div>
</div><!-- fragment --><p>If successful, the adb devices command will show the attached device: </p><div class="fragment"><div class="line">$ adb devices</div>
<div class="line">...</div>
<div class="line">192.168.225.1:5555  device</div>
</div><!-- fragment --><p>When finished using adb over wifi, break the connection between host and device: </p><div class="fragment"><div class="line">adb disconnect 192.168.225.1:5555</div>
</div><!-- fragment --><h2>Reading the log</h2>
<p>From a device shell, use the <b>logread</b> or <b>journalctl</b> command to read the system log. Use <b>grep</b> for filtering.</p>
<p>Example: </p><div class="fragment"><div class="line">$ adb shell logread |grep aos_metering |tail -n 10</div>
<div class="line">May 13 19:56:31 aos daemon.notice aos_metering_app-sv: containerizing /data/polnet/apps/aos_metering_app/aos_metering_app</div>
<div class="line">May 13 19:56:31 aos daemon.notice aos_metering_app-sv: chdir(&quot;/home/apps&quot;)</div>
<div class="line">May 13 19:56:31 aos daemon.notice aos_metering_app-sv: forking /data/polnet/apps/aos_metering_app/aos_metering_app</div>
<div class="line">May 14 02:56:32 aos user.warn aos_metering_ap: [1] m2m.AppEntity.Impl_.initialize (163) - app_config.json does not exist</div>
<div class="line">May 14 02:56:32 aos user.info aos_metering_ap: [1] main (83) - activating</div>
<div class="line">May 14 02:56:32 aos user.info aos_metering_ap: [1] m2m.AppEntity.Impl_.startRegistration (369) - AE registration request</div>
<div class="line">May 14 02:56:32 aos user.info aos_metering_ap: [3] m2m.AppEntity.Impl_.handleRegisterAEResponse (451) - AE Registration complete.  AE-ID = Cmetersvc-smpl</div>
<div class="line">May 14 02:56:32 aos user.info aos_metering_ap: [1] main (98) - activated</div>
<div class="line">May 14 02:56:32 aos user.info aos_metering_ap: [1] create_subscription (149) - subscription: CREATED</div>
<div class="line">May 14 02:56:32 aos user.info aos_metering_ap: [1] create_meter_read_policy (184) - policy creation: CREATED</div>
<div class="line">$</div>
</div><!-- fragment --><h2>Accessing the application environment.</h2>
<p>Running <code>aosapp shell</code> will open a shell in an environment identically to the one the application runs in.</p>
<p>Example: </p><div class="fragment"><div class="line"> aosapp -s 87e76c0 shell</div>
<div class="line">/home/apps # ls -l</div>
<div class="line">ls -l</div>
<div class="line">-rwxr-xr-x    1 aos      root        193456 May 14 03:15 aos_metering_app</div>
<div class="line">-rw-r-----    1 root     root           165 May 14 03:16 app_config.json</div>
<div class="line">-rw-r--r--    1 aos      root           146 May 14 03:15 env</div>
<div class="line">-rw-r--r--    1 aos      root           291 May 14 03:15 manifest.json</div>
<div class="line">-rw-r-----    1 root     root           343 May 14 03:24 meter_data.txt</div>
<div class="line">-rw-r--r--    1 aos      root           138 May 14 03:15 service.conf</div>
<div class="line">/home/apps # </div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
